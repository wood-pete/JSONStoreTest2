<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>index</title>
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
<link rel="shortcut icon" href="images/favicon.png">
<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
<link rel="stylesheet" href="css/main.css">
<script>
	window.$ = window.jQuery = WLJQ;
</script>
</head>
<body style="display: none;">




	<label id="mylabel">My Database Tests</label>
	<br />
	<button type="button" onClick="javascript:myremovetable();">RemoveDB</button>
	<br />
	<button type="button" onClick="javascript:mycreatetable();">CreateDB</button>
	<br />
	<input type="text" id="mytextbox" value="Peteisthedefault"></input>
	<button type="button" onClick="javascript:myadddata();">Add
		Data</button>
	<br />
	<button type="button" onClick="javascript:mydisplaydata();">Display
		All Data</button>
	<br />
	<input type="text" id="mysearchbox" value="hello"></input>
	<button type="button" onClick="javascript:mydisplayquerydata();">Display
		Data Subset</button>
	<br />

	<div id="mylogarea"
		style="width: 300px; height: 150px; font-size: 10px; overflow-y: scroll; background-color: #ccc;">
		This is the log..</div>


	<script src="js/initOptions.js"></script>
	<script src="js/main.js"></script>
	<script src="js/messages.js"></script>

	<script>
	
		//Sets up the table/collection with the search fields
		var collections = {
			mycustomers : {
				searchFields : {
					"name" : "string"
				},
				adapter : {
					name : 'customerAdapter',
					replace : '',
					remove : '',
					add : 'addCustomerAdapter',
					load : {
						procedure : 'getCustomerAdapter',
						params : [],
						key : 'mycustomers'
					},
					accept : function(data) {
						return (data.status === 200);
					}
				}
			}

		};

		//This sets up the options - don't know why
		var options = { //all optional
		//username: 'carlos', //default: 'jsonstore'
		//password: '123' //default: no encryption
		}

		//THIS FUNCTION REMOVED THE TABLE IF IT ALREADY EXISTS
		function myremovetable() {
			mylog("Removing Table...");
			WL.JSONStore.init(collections, options).then(function(res) {
				return WL.JSONStore.get('mycustomers').removeCollection();
			}).then(function(res) {
			}).fail(function(errobject) {
				WL.Logger.debug(errobject.toString());
				mylog("Error removing Table...");
			});

		}

		//THIS IS THE FUNCTION FOR CREATING THE TABLE
		function mycreatetable() {

			mylog("Creating Table...");

			//This actually creates and/or initiates the table with the specified collection and options
			WL.JSONStore.init(collections, options).then(function(res) {
				return WL.JSONStore.get('mycustomers');
			}).then(function(res) {
			}).fail(function(errobject) {
				WL.Logger.debug(errobject.toString());
				mylog("Error creating Table...");
			});

			mylog("Table Created");

		}

		//FUNCTON TO ADD DATA TO JSONSTORE
		function myadddata() {

			//			console.log("Adding data");
			mylog("Adding data");

			//Initiate the JSONStore first - have to wait for this to be initiated before performing operations on it.
			//This method creates the table if it doesn't already exist
			WL.JSONStore.init(collections, options).then(function(res) {

				// Add the data to the database - need to wait for the JSONStore to be initiated!!!!
				return WL.JSONStore.get('mycustomers').add({
					name : mytextbox.value
				}).then(function(res) {
				}).fail(function(errobject) {
					WL.Logger.debug(errobject.toString());
				});

			}).then(function(res) {
			}).fail(function(errobject) {
				WL.Logger.debug(errobject.toString());
			});

			mylog("Finished loading data " + mytextbox.value);

		}

		//FUNCTION TO DISPLAY THE DATA FROM JSON STORE
		function mydisplaydata() {
			mylog("Starting displaying data");

			WL.JSONStore
					.init(collections, options)
					.then(
							function(res) {

								// Add the data to the database - need to wait for the JSONStore to be initiated!!!!
								return WL.JSONStore
										.get('mycustomers')
										.findAll()
										.then(
												function(res) {
													mylog("LIST OF DATA")
													for (index = 0; index < res.length; ++index) {
														mylog(JSON.stringify(res[index].json));
													}
												}).fail(
												function(errobject) {
													WL.Logger.debug(errobject
															.toString());
												});

							}).then(function(res) {
					}).fail(function(errobject) {
						WL.Logger.debug(errobject.toString());
					});

			mylog("Finished displaying data");

		}
		
		function mydisplayquerydata() {
		mylog("Starting displaying query data");
		var query = {name: mysearchbox.value};
		var queryoptions = {
    		exact: false,
    		limit: 10 //returns a maximum of 10 documents
		};

			WL.JSONStore
					.init(collections, options)
					.then(
							function(res) {

								// Add the data to the database - need to wait for the JSONStore to be initiated!!!!
								return WL.JSONStore
										.get('mycustomers')
										.find(query,queryoptions)
										.then(
												function(res) {
													mylog("LIST OF QUERY DATA")
													for (index = 0; index < res.length; ++index) {
														mylog(JSON.stringify(res[index].json));
													}
												}).fail(
												function(errobject) {
													WL.Logger.debug(errobject
															.toString());
												});

							}).then(function(res) {
					}).fail(function(errobject) {
						WL.Logger.debug(errobject.toString());
					});

			mylog("Finished displaying query data");
		}
		

		// METHOD FOR LOGGING EVENTS IN THE DIV-LOGGER
		function mylog(thisevent) {
			var currentdate = new Date();
			var datetime = currentdate.getHours() + ":"
					+ currentdate.getMinutes() + ":" + currentdate.getSeconds();

			mylogarea.innerHTML = mylogarea.innerHTML + "<br/>" + datetime
					+ " " + thisevent;
			mylogarea.scrollTop = mylogarea.scrollHeight
		}
	</script>
</body>
</html>